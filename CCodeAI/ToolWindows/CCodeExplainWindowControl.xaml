<UserControl
    x:Class="CCodeAI.CCodeExplainWindowControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:catalog="clr-namespace:Microsoft.VisualStudio.Imaging;assembly=Microsoft.VisualStudio.ImageCatalog"
    xmlns:converters="clr-namespace:CCodeAI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:imaging="clr-namespace:Microsoft.VisualStudio.Imaging;assembly=Microsoft.VisualStudio.Imaging"
    xmlns:local="clr-namespace:CCodeAI.ToolWindows"
    xmlns:markdown="clr-namespace:MdXaml;assembly=MdXaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:theming="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Imaging"
    xmlns:toolkit="clr-namespace:Community.VisualStudio.Toolkit;assembly=Community.VisualStudio.Toolkit"
    xmlns:util="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Utilities"
    xmlns:viewmodels="clr-namespace:CCodeAI.ViewModels"
    Name="MyToolWindow"
    d:DataContext="{d:DesignInstance Type=viewmodels:CCodeExplainWindowControlViewModel}"
    d:DesignHeight="500"
    d:DesignWidth="300"
    mc:Ignorable="d">
    <UserControl.Resources>
        <local:WhoToImageConverter x:Key="WhoToImageConverter" />
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <Style x:Key="RoundTextBox" TargetType="TextBox">
            <Setter Property="Foreground" Value="Black" />
            <Setter Property="BorderBrush" Value="#CCCCCC" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="5" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TextBox}">
                        <Border
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="5">
                            <ScrollViewer x:Name="PART_ContentHost" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <DrawingImage x:Key="CleanDataDrawingImage">
            <DrawingImage.Drawing>
                <DrawingGroup ClipGeometry="M0,0 V16 H16 V0 H0 Z">
                    <DrawingGroup.Transform>
                        <TranslateTransform X="0.00050070881843566895" Y="0.000500112771987915" />
                    </DrawingGroup.Transform>
                    <DrawingGroup Opacity="1">
                        <GeometryDrawing Geometry="F1 M16,16z M0,0z M9.2,7.492L8.492,6.785 14.147,1.13A0.516,0.516,0,0,1,14.854,1.13A0.5,0.5,0,0,1,14.854,1.837z">
                            <GeometryDrawing.Brush>
                                <SolidColorBrush Opacity="0.1" Color="{DynamicResource VsColor.WindowText}" />
                            </GeometryDrawing.Brush>
                        </GeometryDrawing>
                        <GeometryDrawing Brush="{DynamicResource VsBrush.WindowText}" Geometry="F1 M16,16z M0,0z M15.561,2.561L9.768,8.354 9.061,7.646 14.854,1.854A0.5,0.5,0,1,0,14.146,1.147L8.354,6.939 7.646,6.232 13.439,0.439A1.5,1.5,0,0,1,15.561,2.561z" />
                        <GeometryDrawing Geometry="F1 M16,16z M0,0z M9.5,10.5L6.5,15.5 0.5,9.5 5.5,6.5A2,2,0,0,1,8.328,6.5L9.5,7.672A2,2,0,0,1,9.5,10.5z">
                            <GeometryDrawing.Brush>
                                <SolidColorBrush Opacity="0.1" Color="#FF996F00" />
                            </GeometryDrawing.Brush>
                        </GeometryDrawing>
                        <GeometryDrawing Brush="#FF996F00" Geometry="F1 M16,16z M0,0z M9.854,7.318L8.682,6.146A2.556,2.556,0,0,0,5.229,6.08L0.243,9.071 0.143,9.854 6.143,15.854 6.926,15.754 9.916,10.77A2.5,2.5,0,0,0,9.854,7.318z M6.4,14.694L5.765,14.058 7,12 4.942,13.235 1.307,9.6 4.173,7.88 8.12,11.827z M8.651,10.944L5.056,7.344 5.423,7.124 8.87,10.578z M9.428,9.721L6.282,6.575A1.528,1.528,0,0,1,7.975,6.854L9.146,8.025A1.491,1.491,0,0,1,9.428,9.721z" />
                        <GeometryDrawing Brush="#FF005DBA" Geometry="F1 M16,16z M0,0z M4,4A0.5,0.5,0,0,1,3.6,4.49L2.812,4.647A0.212,0.212,0,0,0,2.649,4.812L2.49,5.6A0.5,0.5,0,0,1,1.51,5.6L1.353,4.81A0.212,0.212,0,0,0,1.188,4.647L0.4,4.49A0.5,0.5,0,0,1,0.4,3.51L1.188,3.353A0.212,0.212,0,0,0,1.351,3.188L1.51,2.4A0.5,0.5,0,0,1,2.49,2.4L2.647,3.188A0.212,0.212,0,0,0,2.812,3.351L3.6,3.51A0.5,0.5,0,0,1,4,4z" />
                        <GeometryDrawing Brush="#FF313C9E" Geometry="F1 M16,16z M0,0z M8.5,2A0.5,0.5,0,0,1,8.1,2.49L7.312,2.647A0.212,0.212,0,0,0,7.149,2.812L6.99,3.6A0.5,0.5,0,0,1,6.01,3.6L5.853,2.81A0.212,0.212,0,0,0,5.688,2.647L4.9,2.49A0.5,0.5,0,0,1,4.9,1.51L5.688,1.353A0.212,0.212,0,0,0,5.851,1.188L6.01,0.4A0.5,0.5,0,0,1,6.99,0.4L7.147,1.188A0.212,0.212,0,0,0,7.312,1.351L8.1,1.51A0.5,0.5,0,0,1,8.5,2z" />
                    </DrawingGroup>
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>
        <DrawingImage x:Key="SendDrawingImage">
            <DrawingImage.Drawing>
                <DrawingGroup ClipGeometry="M0,0 V16 H16 V0 H0 Z">
                    <DrawingGroup Opacity="1">
                        <GeometryDrawing Geometry="F1 M16,16z M0,0z M1.5,1.5L15,7.5 1.5,13.5 4.5,7.5z">
                            <GeometryDrawing.Brush>
                                <SolidColorBrush Opacity="0.1" Color="{DynamicResource VsColor.WindowText}" />
                            </GeometryDrawing.Brush>
                        </GeometryDrawing>
                        <GeometryDrawing Brush="{DynamicResource VsBrush.WindowText}" Geometry="F1 M16,16z M0,0z M1.7,1.043L1.05,1.724 3.941,7.5 1.053,13.276 1.703,13.957 15.203,7.957 15.203,7.043z M2.567,2.523L12.644,7 4.809,7z M4.809,8L12.644,8 2.57,12.477z" />
                    </DrawingGroup>
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>
        <DrawingImage x:Key="PencilLine_dDrawingImage">
            <DrawingImage.Drawing>
                <DrawingGroup ClipGeometry="M0,0 V48 H49 V0 H0 Z">
                    <GeometryDrawing Geometry="F1 M49,48z M0,0z M36.5,22.5L26,12 30.9312,7.06879C31.0708,6.92706 31.2372,6.81445 31.4207,6.73773 31.6041,6.66083 31.8011,6.62128 32,6.62128 32.1989,6.62128 32.3959,6.66083 32.5793,6.73773 32.7628,6.81445 32.9292,6.92706 33.0688,7.06879L41.4312,15.4312C41.5729,15.5709 41.6855,15.7372 41.7624,15.9207 41.8392,16.1041 41.8787,16.3011 41.8787,16.5 41.8787,16.6989 41.8392,16.8959 41.7624,17.0793 41.6855,17.2628 41.5729,17.4293 41.4312,17.5688L36.5,22.5z">
                        <GeometryDrawing.Brush>
                            <SolidColorBrush Opacity="0.1" Color="#FF000000" />
                        </GeometryDrawing.Brush>
                    </GeometryDrawing>
                    <GeometryDrawing Brush="{DynamicResource VsBrush.WindowText}" Geometry="F0 M49,48z M0,0z M42.4887,18.6326L19.5607,41.5607C19.2794,41.842,18.8978,42,18.5,42L9.5,42C9.5,42 8.25736,42 7.37868,41.1213 7.37868,41.1213 6.5,40.2427 6.5,39L6.5,30.6188C6.5,30.6188 6.49793,30.0302 6.72353,29.4809 6.72353,29.4809 6.94913,28.9317 7.36797,28.5107L29.8706,6.00811C29.8706,6.00811 30.2854,5.58683 30.8413,5.35405 30.8413,5.35405 31.3973,5.12128 32,5.12128 32,5.12128 32.6027,5.12128 33.1587,5.35406 33.1587,5.35406 33.7146,5.58683 34.1375,6.01626L42.4919,14.3706C42.4919,14.3706 42.9132,14.7854 43.146,15.3414 43.146,15.3414 43.3787,15.8973 43.3787,16.5 43.3787,16.5 43.3787,17.1027 43.146,17.6587 43.146,17.6587 42.9154,18.2093 42.4919,18.6294L42.4887,18.6326z M40.3787,16.5L40.3706,16.4919 32,8.12128 31.9919,8.12943 9.5,30.6213 9.5,39 17.8787,39 40.3706,16.5081 40.3787,16.5z" />
                    <GeometryDrawing Brush="{DynamicResource VsBrush.WindowText}" Geometry="F1 M49,48z M0,0z M35.4386,23.5599L35.4393,23.5607C35.7206,23.842 36.1022,24 36.5,24 36.8978,24 37.2794,23.842 37.5607,23.5607 37.842,23.2794 38,22.8978 38,22.5 38,22.1022 37.842,21.7206 37.5607,21.4393L37.5599,21.4386 27.0608,10.9395C26.7794,10.658 26.3978,10.5 26,10.5 25.6022,10.5 25.2206,10.658 24.9393,10.9393 24.658,11.2206 24.5,11.6022 24.5,12 24.5,12.3978 24.658,12.7794 24.9393,13.0607L35.4386,23.5599z" />
                    <GeometryDrawing Brush="{DynamicResource VsBrush.WindowText}" Geometry="F1 M49,48z M0,0z M9.15441,29.0331C8.87311,28.7518 8.49157,28.5938 8.09375,28.5938 7.69593,28.5938 7.31439,28.7518 7.03309,29.0331 6.75179,29.3144 6.59375,29.6959 6.59375,30.0938 6.59375,30.4916 6.75179,30.8731 7.03309,31.1544L17.4393,41.5607C17.7206,41.842,18.1022,42,18.5,42L41,42C41.8284,42 42.5,41.3284 42.5,40.5 42.5,39.6716 41.8284,39 41,39L19.1213,39 9.15441,29.0331z" />
                    <GeometryDrawing Brush="{DynamicResource VsBrush.WindowText}" Geometry="F1 M49,48z M0,0z M32.3101,18.3112L32.3107,18.3107C32.592,18.0294 32.75,17.6478 32.75,17.25 32.75,16.8522 32.592,16.4706 32.3107,16.1893L32.3098,16.1885 32.2977,16.1765 32.2968,16.1757C32.0167,15.9028 31.6411,15.75 31.25,15.75 31.205,15.75 31.16,15.752 31.1152,15.7561 30.7654,15.7876 30.4377,15.941 30.1893,16.1893L30.1888,16.1899 12.1899,34.1888 12.1893,34.1893C11.908,34.4706 11.75,34.8522 11.75,35.25 11.75,35.274 11.7506,35.2981 11.7517,35.3221 11.7696,35.6945 11.9257,36.047 12.1893,36.3107 12.4706,36.592 12.8522,36.75 13.25,36.75 13.6478,36.75 14.0294,36.592 14.3107,36.3107L14.3112,36.3101 32.3101,18.3112z" />
                </DrawingGroup>
            </DrawingImage.Drawing>
        </DrawingImage>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" MinHeight="100" />
            <RowDefinition Height="auto" />
            <RowDefinition Height="200" MinHeight="50" />
        </Grid.RowDefinitions>
        <StackPanel Grid.Row="0" Orientation="Horizontal">
            <Button
                Name="cClearBtn"
                Width="28"
                Height="28"
                Margin="5"
                Background="Transparent"
                BorderThickness="0"
                Command="{Binding ClearCommand}"
                ToolTip="清空记录">
                <Image Source="{StaticResource CleanDataDrawingImage}" />
            </Button>
            <Button
                Width="28"
                Height="28"
                Margin="5"
                Background="Transparent"
                BorderThickness="0"
                Command="{Binding OpenCodeGenWindowCommand}"
                ToolTip="Open CodeGen Window">
                <Image Source="{StaticResource PencilLine_dDrawingImage}" />
            </Button>
        </StackPanel>
        <ItemsControl
            Name="cChatList"
            Grid.Row="1"
            Background="{DynamicResource VsBrush.Window}"
            BorderThickness="0"
            ItemsSource="{Binding ChatDatas}"
            ScrollViewer.CanContentScroll="False"
            ScrollViewer.HorizontalScrollBarVisibility="Disabled">
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Grid Margin="0,5,0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="40" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <Image
                            Margin="5,10,10,10"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Source="{Binding WhoText, Converter={StaticResource WhoToImageConverter}}" />
                        <!--<TextBox
                            Grid.Column="1"
                            VerticalAlignment="Center"
                            Background="Transparent"
                            BorderThickness="0"
                            Foreground="{DynamicResource VsBrush.WindowText}"
                            IsReadOnly="True"
                            Text="{Binding Content}"
                            TextWrapping="Wrap" />-->
                        <Border
                            Grid.Column="1"
                            Padding="5,2"
                            BorderBrush="#19000000"
                            BorderThickness="1"
                            CornerRadius="5">
                            <markdown:MarkdownScrollViewer
                                xml:space="preserve"
                                Foreground="{DynamicResource VsBrush.WindowText}"
                                Markdown="{Binding Content}"
                                VerticalScrollBarVisibility="Disabled" />
                        </Border>
                    </Grid>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
        <GridSplitter
            Grid.Row="2"
            Height="3"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            Background="{DynamicResource VsBrush.Window}"
            ResizeBehavior="PreviousAndNext"
            ResizeDirection="Rows" />
        <ProgressBar
            Name="cProgressBar"
            Grid.Row="3"
            Height="2"
            VerticalAlignment="Top"
            IsIndeterminate="{Binding IsLoading}"
            Visibility="{Binding SendCommand.IsRunning, Converter={StaticResource BoolToVisibilityConverter}}"
            Value="100" />
        <Grid Grid.Row="3" Margin="0,4,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <TextBox
                x:Name="cSendText"
                AcceptsReturn="True"
                Background="{DynamicResource VsBrush.Window}"
                BorderBrush="Gray"
                Foreground="{DynamicResource VsBrush.WindowText}"
                Text="{Binding Question, UpdateSourceTrigger=PropertyChanged}"
                TextWrapping="Wrap"
                VerticalScrollBarVisibility="Auto">
                <TextBox.InputBindings>
                    <KeyBinding
                        Key="Enter"
                        Command="{Binding SendCommand}"
                        Modifiers="Ctrl" />
                </TextBox.InputBindings>
            </TextBox>
            <Button
                x:Name="cAskBtn"
                Grid.Column="1"
                Width="30"
                Height="25"
                Margin="5,0"
                VerticalAlignment="Top"
                Background="Transparent"
                BorderThickness="0"
                Command="{Binding SendCommand}"
                IsEnabled="{Binding !IsLoading}"
                ToolTip="发送">
                <Image Source="{StaticResource SendDrawingImage}" />
            </Button>
        </Grid>

    </Grid>
</UserControl>
